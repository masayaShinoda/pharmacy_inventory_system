{% extends "components/layout.html" %}
{% block title %}
    Inventory
{% endblock title %}
{% block body %}
    <header class="mb-5">
        <h2 class="text-2xl">Inventory</h2>
    </header>
    <section class="flex justify-between items-center mb-5">
        {% if pharmacies %}
            <select id="selected-pharmacy" class="dark:text-black">
                <option value="">Select pharmacy</option>
                {% for pharmacy in pharmacies %}<option value="{{ pharmacy.id }}">{{ pharmacy.name }}</option>
                {% endfor %}
            </select>
        {% else %}
            <p>No pharmacy found.</p>
        {% endif %}
    </section>
    <section class="flex flex-col mb-3 w-full">
        {% if pharmacies %}
            <table class="w-full border-separate border-spacing-0 text-sm text-left">
                <thead>
                    <tr class="sticky top-0 text-white bg-emerald-700 dark:bg-emerald-700">
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">Generic name(s)</th>
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">Brand name(s)</th>
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">Purpose</th>
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">Indications</th>
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">Dosage and administration</th>
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">DO NOT USE</th>
                        <th class="sticky top-0 py-1 px-2 border border-emerald-600">STOP USE</th>
                    </tr>
                </thead>
                <tbody>
                    {% if drugs %}
                        {% for drug in drugs %}
                            <tr>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                    {% for name in drug.open_fda.generic_name %}
                                    <span class="inline-block">
                                        {{ name }}
                                    </span>
                                    {% endfor %}
                                </td>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                    {% for name in drug.open_fda.brand_name %}
                                    <span class="inline-block">
                                        {{ name }}
                                    </span>
                                    {% endfor %}
                                </td>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                    {% for purpose in drug.purpose %}
                                    <span class="inline-block">
                                        {{ purpose }}
                                    </span>
                                    {% endfor %}
                                </td>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                    {% for usage in drug.indications_and_usage %}
                                    <span class="inline-block">
                                        {{ usage|slice:"0:64" }}...
                                    </span>
                                    {% endfor %}
                                </td>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                {% for dosage_and_administration in drug.dosage_and_administration %}
                                <span class="inline-block">
                                    {{ dosage_and_administration|slice:"0:64" }}...
                                </span>
                                {% endfor %}
                                </td>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                    {% for do_not_use in drug.do_not_use %}
                                    <span class="inline-block">
                                        {{ do_not_use|slice:"0:64" }}...
                                    </span>
                                    {% endfor %}
                                </td>
                                <td class="p-2 border border-neutral-100 dark:border-neutral-700 align-top">
                                    {% for stop_use in drug.stop_use %}
                                    <span class="inline-block">
                                        {{ stop_use|slice:"0:64" }}...
                                    </span>
                                    {% endfor %}
                                </td>
                            </tr>
                        
                            {% endfor %}
                    {% else %}
                        <tr>
                            <td class="p-2">No drugs found.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        {% endif %}
    </section>
    <script>
      document.addEventListener("DOMContentLoaded", (event) => {
        const select_pharmacy = document.getElementById("selected-pharmacy")
        
        const selected_pharmacy_param = (new URLSearchParams(window.location.search)).get("pharmacy")

        if(selected_pharmacy_param) {
            Array.from(document.querySelector("#selected-pharmacy").querySelectorAll("option")).map(option => {
                if(option.value === selected_pharmacy_param) {
                    option.selected = true
                } else {
                    option.selected = false
                }
            }) 
        }
        
        select_pharmacy.addEventListener("change", (event) => {
            if(event.target.value) {
                window.location.assign(`${window.location.origin}/inventory?pharmacy=${event.target.value}`)
            }
        })
      })
    </script>
{% endblock body %}
